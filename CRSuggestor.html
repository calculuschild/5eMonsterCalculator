<html>
<body onload="setupPage()">
<h1>Monster Challenge Rating Calculator</h1>

<div id="leftCol" style="float:left">

Base CR (Choose a base CR to give your monster some starting values)
<table>
<tr>
	<td><button onclick="setBaseCR(0)">0</button></td>
	<td><button onclick="setBaseCR(1/8)">1/8</button></td>
	<td><button onclick="setBaseCR(1/4)">1/4</button></td>
	<td><button onclick="setBaseCR(1/2)">1/2</button></td>
	<td><button onclick="setBaseCR(1)">1</button></td>
	<td><button onclick="setBaseCR(2)">2</button></td>
	<td><button onclick="setBaseCR(3)">3</button></td>
	<td><button onclick="setBaseCR(4)">4</button></td>
	<td><button onclick="setBaseCR(5)">5</button></td>
	<td><button onclick="setBaseCR(6)">6</button></td>
	<td><button onclick="setBaseCR(7)">7</button></td>
	<td><button onclick="setBaseCR(8)">8</button></td>
	<td><button onclick="setBaseCR(9)">9</button></td>
	<td><button onclick="setBaseCR(10)">10</button></td>
	<td><button onclick="setBaseCR(11)">11</button></td>
	<td><button onclick="setBaseCR(12)">12</button></td>
	<td><button onclick="setBaseCR(13)">13</button></td>
	<td><button onclick="setBaseCR(14)">14</button></td>
	<td><button onclick="setBaseCR(15)">15</button></td>
</tr>
</table>

Defensive CR: <span id="defensiveCRDisplay">Unknown</span> <br>
Offensive CR: <span id="offensiveCRDisplay">Unknown</span> <br>
<b>Total CR: <span id="totalCRDisplay">Unknown</span></b>

<h3>Monster Name</h3>
<table>
  <tr>
	<td>Monster Name:</td>
	<td><input type="text" id="monsterName"		value="Name"></td>
  </tr>
</table>

<h3>Monster Statistics</h3>
<table>
  <tr>
	<td>CR</td>
	<td><input type="text" id="challengeRating"	onchange="totalCR = eval(this.value); recalcTotalCR();"></td>
	<td><button onclick="document.getElementById('challengeRating').value = nextCR(eval(document.getElementById('challengeRating').value), 1); ">+</button></td>
	<td><button onclick="document.getElementById('challengeRating').value = nextCR(eval(document.getElementById('challengeRating').value), -1);">-</button></td>
  </tr>
  <tr>
	<td>Desired CR</td>
	<td><input type="text" id="desiredChallengeRating"	onchange="desiredCR = eval(this.value);"></td>
	<td><button onclick="document.getElementById('desiredChallengeRating').value = nextCR(eval(document.getElementById('desiredChallengeRating').value), 1); ">+</button></td>
	<td><button onclick="document.getElementById('desiredChallengeRating').value = nextCR(eval(document.getElementById('desiredChallengeRating').value), -1);">-</button></td>
  </tr>
  <tr>
	<td>Armor Class:</td>
	<td><input type="text" id="armorClass"		onchange="AC = parseInt(this.value); recalcTotalCR();"></td>
	<td><button onclick="addValue(document.getElementById('armorClass'), 1)">+</button></td>
	<td><button onclick="addValue(document.getElementById('armorClass'), -1)">-</button></td>	
  </tr>
  <tr>
	<td>Hit Points:</td>
	<td><input type="text" id="hitPoints"		onchange="HP = parseInt(this.value); recalcTotalCR();"></td>
	<td><button onclick="addValue(document.getElementById('hitPoints'), 1)">+</button></td>
	<td><button onclick="addValue(document.getElementById('hitPoints'), -1)">-</button></td>
  </tr>
  <tr>
	<td>Estimated Attack Bonus:</td>
	<td><input type="text" id="attackBonus"></td>
  </tr>
  <tr>
	<td>Estimated Damage Per Round:</td>
	<td><input type="text" id="damagePerRound"></td>
  </tr>
</table>

<h3>Monster Features</h3>
<table style="font-size:x-small">
<tr>
	<td><input type="checkbox" value="Aggressive"		onchange="setFeature(this.value, this.checked); recalcTotalCR();">Aggressive</input></td>
	<td><input type="checkbox" value="Ambusher"			onchange="setFeature(this.value, this.checked); recalcTotalCR();">Ambusher</input></td>
	<td><input type="checkbox" value="Amorphous"		onchange="setFeature(this.value, this.checked); recalcTotalCR();">Amorphous</input></td>
	<td><input type="checkbox" value="Amphibious"		onchange="setFeature(this.value, this.checked); recalcTotalCR();">Amphibious</input></td>
	<td><input type="checkbox" value="Angelic Weapons"	onchange="setFeature(this.value, this.checked); recalcTotalCR();">Angelic Weapons</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featAntimagicSusceptibility" onchange="recalcTotalCR()">Antimagic Susceptibility</input></td>
	<td><input type="checkbox" id="featAvoidance" onchange="recalcTotalCR()">Avoidance</input></td>
	<td><input type="checkbox" id="featBlindSenses" onchange="recalcTotalCR()">Blind Senses</input></td>
	<td><input type="checkbox" id="featBloodFrenzy" onchange="recalcTotalCR()">Blood Frenzy</input></td>
	<td><input type="checkbox" id="featBreathWeapon" onchange="recalcTotalCR()">Breath Weapon</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featBrute" onchange="recalcTotalCR()">Brute</input></td>
	<td><input type="checkbox" id="featAvoidance" onchange="recalcTotalCR()">Chameleon Skin</input></td>
	<td><input type="checkbox" id="featChameleonSkin" onchange="recalcTotalCR()">Change Shape</input></td>
	<td><input type="checkbox" id="featCharge" onchange="recalcTotalCR()">Charge</input></td>
	<td><input type="checkbox" id="featCharm" onchange="recalcTotalCR()">Charm</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featConstrict" onchange="recalcTotalCR()">Constrict</input></td>
	<td><input type="checkbox" id="featDamageAbsorption" onchange="recalcTotalCR()">Damage Absorption</input></td>
	<td><input type="checkbox" id="featDamageTransfer" onchange="recalcTotalCR()">Damage Transfer</input></td>
	<td><input type="checkbox" id="featDeathBurst" onchange="recalcTotalCR()">Death Burst</input></td>
	<td><input type="checkbox" id="featDevilSight" onchange="recalcTotalCR()">Devil Sight</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featDive" onchange="recalcTotalCR()">Dive</input></td>
	<td><input type="checkbox" id="featEcholocation" onchange="recalcTotalCR()">Echolocation</input></td>
	<td><input type="checkbox" id="featElementalBody" onchange="recalcTotalCR()">Elemental Body</input></td>
	<td><input type="checkbox" id="featEnlarge" onchange="recalcTotalCR()">Enlarge</input></td>
	<td><input type="checkbox" id="featEtherealness" onchange="recalcTotalCR()">Etherealness</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featFalse Appearance" onchange="recalcTotalCR()">False Appearance</input></td>
	<td><input type="checkbox" id="featFeyAncestry" onchange="recalcTotalCR()">Fey Ancestry</input></td>
	<td><input type="checkbox" id="featFiendishBlessing" onchange="recalcTotalCR()">Fiendish Blessing</input></td>
	<td><input type="checkbox" id="featFlyby" onchange="recalcTotalCR()">Flyby</input></td>
	<td><input type="checkbox" id="featFrightfulPresence" onchange="recalcTotalCR()">Frightful Presence</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featGrappler" onchange="recalcTotalCR()">Grappler</input></td>
	<td><input type="checkbox" id="featHoldBreath" onchange="recalcTotalCR()">Hold Breath</input></td>
	<td><input type="checkbox" id="featHorrifyingVisage" onchange="recalcTotalCR()">Horrifying Visage</input></td>
	<td><input type="checkbox" id="featIllumination" onchange="recalcTotalCR()">Illumination</input></td>
	<td><input type="checkbox" id="featIllusoryAppearance" onchange="recalcTotalCR()">Illusory Appearance</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featImmutableForm" onchange="recalcTotalCR()">Immutable Form</input></td>
	<td><input type="checkbox" id="featIncorporealMovement" onchange="recalcTotalCR()">Incorporeal Movement</input></td>
	<td><input type="checkbox" id="featInnateSpellcasting" onchange="recalcTotalCR()">Innate Spellcasting</input></td>
	<td><input type="checkbox" id="featInscrutable" onchange="recalcTotalCR()">Inscrutable</input></td>
	<td><input type="checkbox" id="featInvisibility" onchange="recalcTotalCR()">Invisibility</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featKeenSenses" onchange="recalcTotalCR()">Keen Senses</input></td>
	<td><input type="checkbox" id="featLabrynthineRecall" onchange="recalcTotalCR()">Labrynthine Recall</input></td>
	<td><input type="checkbox" id="featLeadership" onchange="recalcTotalCR()">Leadership</input></td>
	<td><input type="checkbox" id="featLegendaryResistance" onchange="recalcTotalCR()">Legendary Resistance</input></td>
	<td><input type="checkbox" id="featLifeDrain" onchange="recalcTotalCR()">Life Drain</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featLightSensitivity" onchange="recalcTotalCR()">Light Sensitivity</input></td>
	<td><input type="checkbox" id="featMagicResistance" onchange="recalcTotalCR()">Magic Resistance</input></td>
	<td><input type="checkbox" id="featMagicWeapons" onchange="recalcTotalCR()">Magic Weapons</input></td>
	<td><input type="checkbox" id="featMartialAdvantage" onchange="recalcTotalCR()">Martial Advantage</input></td>
	<td><input type="checkbox" id="featMimicry" onchange="recalcTotalCR()">Mimicry</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featNimbleEscape" onchange="recalcTotalCR()">Nimble Escape</input></td>
	<td><input type="checkbox" id="featOtherworldlyPerception" onchange="recalcTotalCR()">Otherworldly Perception</input></td>
	<td><input type="checkbox" id="featPackTactics" onchange="recalcTotalCR()">Pack Tactics</input></td>
	<td><input type="checkbox" id="featParry" onchange="recalcTotalCR()">Parry</input></td>
	<td><input type="checkbox" id="featPossession" onchange="recalcTotalCR()">Possession</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featPounce" onchange="recalcTotalCR()">Pounce</input></td>
	<td><input type="checkbox" id="featPsychicDefense" onchange="recalcTotalCR()">Psychic Defense</input></td>
	<td><input type="checkbox" id="featRampage" onchange="recalcTotalCR()">Rampage</input></td>
	<td><input type="checkbox" id="featReactive" onchange="recalcTotalCR()">Reactive</input></td>
	<td><input type="checkbox" id="featReadThoughts" onchange="recalcTotalCR()">Read Thoughts</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featReckless" onchange="recalcTotalCR()">Reckless</input></td>
	<td><input type="checkbox" id="featRedirectAttack" onchange="recalcTotalCR()">Redirect Attack</input></td>
	<td><input type="checkbox" id="featReel" onchange="recalcTotalCR()">Reel</input></td>
	<td><input type="checkbox" id="featRegeneration" onchange="recalcTotalCR()">Regeneration</input></td>
	<td><input type="checkbox" id="featRejuvenation" onchange="recalcTotalCR()">Rejuvenation</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featRelentless" onchange="recalcTotalCR()">Relentless</input></td>
	<td><input type="checkbox" id="featShadowStealth" onchange="recalcTotalCR()">Shadow Stealth</input></td>
	<td><input type="checkbox" id="featShapeChanger" onchange="recalcTotalCR()">Shape Changer</input></td>
	<td><input type="checkbox" id="featSiegeMonster" onchange="recalcTotalCR()">Siege Monster</input></td>
	<td><input type="checkbox" id="featSlippery" onchange="recalcTotalCR()">Slippery</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featSpellcasting" onchange="recalcTotalCR()">Spellcasting</input></td>
	<td><input type="checkbox" id="featSpiderClimb" onchange="recalcTotalCR()">Spider Climb</input></td>
	<td><input type="checkbox" id="featStandingLeap" onchange="recalcTotalCR()">Standing Leap</input></td>
	<td><input type="checkbox" id="featSteadfast" onchange="recalcTotalCR()">Steadfast</input></td>
	<td><input type="checkbox" id="featStench" onchange="recalcTotalCR()">Stench</input></td>
<tr>
	<td><input type="checkbox" id="featSunlightSensitivity" onchange="recalcTotalCR()">Sunlight Sensitivity</input></td>
	<td><input type="checkbox" id="featSuperiorInvisibility" onchange="recalcTotalCR()">Superior Invisibility</input></td>
	<td><input type="checkbox" id="featSureFooted" onchange="recalcTotalCR()">Sure-Footed</input></td>
	<td><input type="checkbox" id="featSurpriseAttack" onchange="recalcTotalCR()">Surprise Attack</input></td>
	<td><input type="checkbox" id="featSwallow" onchange="recalcTotalCR()">Swallow</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featTeleport" onchange="recalcTotalCR()">Teleport</input></td>
	<td><input type="checkbox" id="featTerrainCamoflage" onchange="recalcTotalCR()">Terrain Camoflage</input></td>
	<td><input type="checkbox" id="featTunneler" onchange="recalcTotalCR()">Tunneler</input></td>
	<td><input type="checkbox" id="featTurnImmunity" onchange="recalcTotalCR()">Turn Immunity</input></td>
	<td><input type="checkbox" id="featTurnResistance" onchange="recalcTotalCR()">Turn Resistance</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featTwoHeads" onchange="recalcTotalCR()">Two Heads</input></td>
	<td><input type="checkbox" id="featUndeadFortitude" onchange="recalcTotalCR()">Undead Fortitude</input></td>
	<td><input type="checkbox" id="featWeb" onchange="recalcTotalCR()">Web</input></td>
	<td><input type="checkbox" id="featWebSense" onchange="recalcTotalCR()">Web Sense</input></td>
	<td><input type="checkbox" id="featWebWalker" onchange="recalcTotalCR()">Web Walker</input></td>
</tr>
<tr>
	<td><input type="checkbox" id="featWoundedFury" onchange="recalcTotalCR()">Wounded Fury</input></td>
</tr>
</table>

<br>
<button onclick="saveMonster()">Save</button>
</div>

<div id="rightCol">	
	<h3>Party Thresholds</h3>
	<b>Easy:</b> <span id="easyThreshold"></span> <br>
	<b>Medium:</b> <span id="mediumThreshold"></span> <br>
	<b>Hard:</b> <span id="hardThreshold"></span> <br>
	<b>Deadly:</b> <span id="deadlyThreshold"></span> <br>

	<h3>Party Members</h3>
	<table id="partyList">
		<tr>
			<td>Number of Characters</td><td>Character Level</td>
			<td><button onclick="addPartyRow();">Add row</button></td>
		</tr>
		<tr>
			<td><input type='text' onclick='calculatePartyThresholds();'></input></td>
			<td><input type='text' onclick='calculatePartyThresholds();'></input></td>
		</tr>
	</table>

	<h3>Monster List</h3>  Difficulty: <span id="encounterDifficulty"></span>
	Desired Difficulty:
	<button onclick="adjustEncounter('Easy');">Easy</button>
	<button onclick="adjustEncounter('Medium');">Medium</button>
	<button onclick="adjustEncounter('Hard');">Hard</button>
	<button onclick="adjustEncounter('Deadly');">Deadly</button>
	<table id="monsterList">
		<tr><td>Monster Name</td><td>CR</td><td>Count</td><td></td><td></td></tr>
	</table>
</div>

<script>
	var defensiveCR;
	var offensiveCR;
	var totalCR;
	var desiredCR;
	
	var HP;
	var AC;
	var AB;
	var DPR;
	var monsterFeats = {};
	var encounterSize = 0;
	
	//Party Info
	var partySize = 0;	
	
	var editing = false;
	var editingMonster = 0;
	
	function adjustEncounter(difficulty) {
		var minXPThreshold;
		var maxXPThreshold
		if(difficulty == "Easy") {
			minXPThreshold = document.getElementById("easyThreshold").innerHTML;
			maxXPThreshold = document.getElementById("mediumThreshold").innerHTML; }
		if(difficulty == "Medium") {
			minXPThreshold = document.getElementById("mediumThreshold").innerHTML;
			maxXPThreshold = document.getElementById("hardThreshold").innerHTML; }
		if(difficulty == "Hard") {
			minXPThreshold = document.getElementById("hardThreshold").innerHTML;
			maxXPThreshold = document.getElementById("deadlyThreshold").innerHTML; }
		if(difficulty == "Deadly") {
			minXPThreshold = document.getElementById("deadlyThreshold").innerHTML;
			maxXPThreshold = document.getElementById("deadlyThreshold").innerHTML * 1.1; }	//Let a Deadly encounter be only 10% above deadly.  Still deadly but not impossibly high.	
	
		var monsterArray = JSON.parse(localStorage.getItem('monsterArray'));
	
		//Add button for "Mob", "Individuals" battle?
	
		//FIRST STEP: RAISE OR LOWER NUMBER OF MONSTERS
			//RAISING DIFFICULTY
				//If already 2 or more of the same monster, add some more.  Probably meant as a mob or group battle.
				//If one of each monster, this is probably meant to be some individually strong monsters, so don't change numbers.
			//LOWERING DIFFICULTY
				//If already at one of each monster type, don't remove.  Probably meant to give particular fight dynamics.
				//If 2 or more of the same monster, try to lower until one of each monster or equal to number of players
				
		console.log("encounter diff " + calculateEncounterDifficulty(monsterArray));
		console.log("maxXPThreshold " + maxXPThreshold);
				
		//SECOND STEP: RAISE OR LOWER CR OF EACH MONSTER TYPE ONE BY ONE
		while(calculateEncounterDifficulty(monsterArray) > maxXPThreshold)
		{
			if(calculateEncounterDifficulty(monsterArray) > maxXPThreshold)
			{
				for(var i = 0; i < monsterArray.length; i++)
				{
					console.log("lowering difficulty...");
					monsterArray[i] = lowerCR(monsterArray[i]);
					if(calculateEncounterDifficulty(monsterArray) <= maxXPThreshold)
						break;
				}
			}
			//else if(calculateEncounterDifficulty(monsterArray) < minXPThreshold)
			//{
			//	break;
			//}
		}
		
		var table = document.getElementById("monsterList");
		for(var i = 0; i < monsterArray.length; i++)
		{
			console.log(monsterArray[i]);
			var row = table.rows[editingMonster];
			var commentCell = row.cells[7];
			//var comments = "New CR: " + monsterArray[i]["totalCR"] + "<br>";
			//comments += "New HP: " + monsterArray[i]["hitPoints"] + "<br>";
			//comments += "New AC: " + monsterArray[i]["armorClass"] + "<br>";
			//comments += "New AB: " + monsterArray[i]["attackBonus"] + "<br>";
			//comments += "New DPR: " + monsterArray[i]["damagePerRound"] + "<br>";
			commentCell.innerHTML = monsterArray[i];
		}	
	}
	
	function setBaseCR(val) {
		AC = ACLevels[val];
		HP = HPLevels[val];
		totalCR = val;
		document.getElementById("armorClass").value = AC;
		document.getElementById("hitPoints").value = HP;
		document.getElementById("challengeRating").value = totalCR;
		
		recalcTotalCR();
	}
	
	function addPartyRow() {
		var table = document.getElementById("partyList");
		var row = table.insertRow(-1);
		var numberCell = row.insertCell(-1);
		numberCell.innerHTML = "<input type='text' onclick='calculatePartyThresholds();'></input>";
		var levelCell = row.insertCell(-1);
		levelCell.innerHTML = "<input type='text' onclick='calculatePartyThresholds();'></input>";
		var deleteButtonCell = row.insertCell(-1);
		deleteButtonCell.innerHTML = "<button onclick='deletePlayer(this.parentNode.parentNode.rowIndex)'>Delete</button>";
	}
	
	function deletePlayer(playerIndex) {
		var table = document.getElementById("partyList");
		table.deleteRow(playerIndex);
	}
	
	function calculatePartyThresholds() {
		var table = document.getElementById("partyList");
		partySize = 0;		//Clear this count to start over
		var totalXPEasy = 0;
		var totalXPMedium = 0;
		var totalXPHard = 0;
		var totalXPDeadly = 0;
		for(var i = 1; i < table.rows.length; i++)
		{
			if(table.rows[i].cells[0].firstElementChild.value != "" && table.rows[i].cells[1].firstElementChild.value != "")	//Skip rows with blanks
			{
				var playerCount = parseInt(table.rows[i].cells[0].firstElementChild.value);
				partySize += playerCount;
				
				var playerLevel = parseInt(table.rows[i].cells[1].firstElementChild.value)
				totalXPEasy		+= playerCount * XPThresholdEasy[playerLevel];
				totalXPMedium	+= playerCount * XPThresholdMedium[playerLevel];
				totalXPHard		+= playerCount * XPThresholdHard[playerLevel];
				totalXPDeadly	+= playerCount * XPThresholdDeadly[playerLevel];
			}
		}
		document.getElementById("easyThreshold").innerHTML = totalXPEasy;
		document.getElementById("mediumThreshold").innerHTML = totalXPMedium;
		document.getElementById("hardThreshold").innerHTML = totalXPHard;
		document.getElementById("deadlyThreshold").innerHTML = totalXPDeadly;
		
		calculateEncounterDifficulty(JSON.parse(localStorage.getItem('monsterArray')));
	}
	
	function calculateEncounterDifficulty(monsterArray) {
		var encounterSize = 0;
		var totalXP = 0;
		
		for(var i = 0; i < monsterArray.length; i++)
		{
			var monsterData = monsterArray[i];
			var monsterCount = monsterData["count"];
			console.log("Monster count " + monsterCount);
			encounterSize += monsterCount;
			
			var monsterCR = monsterData["totalCR"];
			totalXP += monsterCount * XPLevels[monsterCR]; 
		}
		document.getElementById("encounterDifficulty").innerHTML = totalXP;
		
		return totalXP;
	}
	
	function setFeature(value, isSet) {
		monsterFeats[value] = isSet;
		console.log(monsterFeats);
	}
	
	function addValue(element, value) {
		element.value = parseInt(element.value) + value;
		element.onchange();
	}
	
	function lowerCR(monsterData) {			//Given a monsterData array, return a modified one with CR one step lower
	//Capture initial monster stats
		var baseHP = monsterData["hitPoints"];
		var baseAC = monsterData["armorClass"];
		
		var baseAB = monsterData["attackBonus"];
		var baseDPR = monsterData["damagePerRound"];
		
		var baseFeats = monsterData["monsterFeats"];
		
		var effectiveTotalCR = monsterData["totalCR"];
		var effectiveOffensiveCR = recalcOffensiveCR(baseAB, baseDPR, baseHP, baseFeats);
		var effectiveDefensiveCR = recalcDefensiveCR(baseAC, baseHP, baseFeats);
		
		var targetCR = monsterData["totalCR"] - 1;
	
	//Sort monster features by strength and store in a list
		//Offensive Features
		var monsterFeatsOffensive = [];
		if(baseFeats["DamageTransfer"])		monsterFeatsOffensive.push("DamageTransfer");
		if(baseFeats["Enlarge"])			monsterFeatsOffensive.push("Enlarge");
		if(baseFeats["MartialAdvantage"])	monsterFeatsOffensive.push("MartialAdvantage");
		if(baseFeats["Swallow"])			monsterFeatsOffensive.push("Swallow");
		if(baseFeats["Charge"])				monsterFeatsOffensive.push("Charge");
		if(baseFeats["Dive"])				monsterFeatsOffensive.push("Dive");
		if(baseFeats["Pounce"])				monsterFeatsOffensive.push("Pounce");
		if(baseFeats["SurpriseAttack"])		monsterFeatsOffensive.push("SurpriseAttack");
		if(baseFeats["WoundedFury"])		monsterFeatsOffensive.push("WoundedFury");
		if(baseFeats["BloodFrenzy"])		monsterFeatsOffensive.push("BloodFrenzy");
		if(baseFeats["NimbleEscape"])		monsterFeatsOffensive.push("NimbleEscape");
		if(baseFeats["Ambusher"])			monsterFeatsOffensive.push("Ambusher");
		if(baseFeats["PackTactics"])		monsterFeatsOffensive.push("PackTactics");
		if(baseFeats["ElementalBody"])		monsterFeatsOffensive.push("ElementalBody");
		if(baseFeats["Aggressive"])			monsterFeatsOffensive.push("Aggressive");
		if(baseFeats["Rampage"])			monsterFeatsOffensive.push("Rampage");
		
		//Defensive Features
		var monsterFeatsDefensive = [];
		
	//Repeat this until CR is lowered by 1		
		while(effectiveTotalCR > targetCR)
		{
			if(effectiveDefensiveCR > effectiveOffensiveCR) //========----- LOWER DEFENSIVE CR			
			{
			//STEP 1: Remove monster features until only one defensive feature is left
				if(monsterFeatsDefensive.length > 1)	
				{
					var featToCut = monsterFeatsDefensive[0];
					delete baseFeats[featToCut];
					delete monsterFeatsOffensive[featToCut];
					monsterFeatsDefensive = monsterFeatsDefensive.slice(1);	//Take first item out of the FEAT list
					console.log(monsterFeatsDefensive);
					console.log("CUT OFF A DEFENSIVE MONSTER FEAT");
				}

			//STEP 2: Lower base AC up to a point
				else if(baseAC > ACLevels[targetCR] + 2)
				{
					baseAC -= 1;
					console.log("LOWERED BASE AC to " + baseAC);
				}
			
			//STEP 3: Lower base HP
				else if(baseHP > HPLevels[targetCR])
				{
					var baseHPCR = getHPCR(baseHP);
					baseHP = Math.round((HPLevels[nextLowerCR(baseHPCR)] + HPLevels[nextLowerCR(nextLowerCR(baseHPCR))]) / 2);
					console.log("LOWERED BASE HP to " + baseHP);
				}
				
			//STEP 4: Lower base AC even more
				else if(baseAC > ACLevels[targetCR])
				{
					baseAC -= 1;
					console.log("LOWERED BASE AC to " + baseAC);
				}

				effectiveDefensiveCR = recalcDefensiveCR(baseAC, baseHP, monsterFeatsDefensive);
				console.log("effectiveDefensiveCR " + effectiveDefensiveCR);					
			}
			else											//========----- LOWER OFFENSIVE CR		
			{
			//STEP 1: Remove monster features until only one offensive feature is left
				if(monsterFeatsOffensive.length > 1)
				{
					var featToCut = monsterFeatsOffensive[0];
					delete baseFeats[featToCut];
					delete monsterFeatsDefensive[featToCut];
					monsterFeatsOffensive = monsterFeatsOffensive.slice(1); //Take first item out of the FEAT list
					console.log(monsterFeatsOffensive);
					console.log("CUT OFF AN OFFENSIVE MONSTER FEAT");
				}

			//STEP 2: Lower base AB up to a point
				else if(baseAB > ABLevels[targetCR] + 2)
				{
					baseAB -= 1;
					console.log("LOWERED BASE AB to " + baseAB);
				}
			
			//STEP 3: Lower base DPR
				else if(baseDPR > DPRLevels[targetCR])
				{
					var baseDPRCR = getDPRCR(baseDPR);
					baseDPR = Math.round((DPRLevels[nextLowerCR(baseDPRCR)] + DPRLevels[nextLowerCR(nextLowerCR(baseDPRCR))]) / 2);
					console.log("LOWERED BASE DPR to " + baseDPR);
				}
				
			//STEP 4: Lower base AB even more
				else if(baseAB > ABLevels[targetCR])
				{
					baseAB -= 1;
					console.log("LOWERED BASE AB to " + baseAB);
				}
		
				effectiveOffensiveCR = recalcOffensiveCR(baseAB, baseDPR, baseHP, monsterFeatsDefensive);
				console.log("effectiveOffensiveCR " + effectiveOffensiveCR);
			}	//END CALCULATING OFFENSIVE CR
			
			//Recalc total CR.  If total CR is target, end
			effectiveTotalCR = (effectiveDefensiveCR + effectiveOffensiveCR)/2;
		}
				
		//Handle cases when totalCR is around the fractional CRs
		if	   (0 	 <= effectiveTotalCR && effectiveTotalCR < 1/16)	effectiveTotalCR = 0;
		else if(1/16 <= effectiveTotalCR && effectiveTotalCR < 3/16)	effectiveTotalCR = 1/8;
		else if(3/16 <= effectiveTotalCR && effectiveTotalCR < 6/16)	effectiveTotalCR = 1/4;
		else if(6/16 <= effectiveTotalCR && effectiveTotalCR < 12/16)	effectiveTotalCR = 1/2;
		else effectiveTotalCR = Math.round(effectiveTotalCR);
		console.log("effectiveTotalCR" + effectiveTotalCR);
		
		monsterData["hitPoints"] = baseHP;
		monsterData["armorClass"] = baseAC;
		monsterData["attackBonus"] = baseAB;
		monsterData["damagePerRound"] = baseDPR;
		monsterData["monsterFeats"] = baseFeats;
		monsterData["totalCR"] = effectiveTotalCR;
		
		return monsterData;
	}
	
	function recalcTotalCR() {
		var defensiveCR = recalcDefensiveCR(AC, HP, monsterFeats);
		var offensiveCRStats = estimateOffensiveCR(defensiveCR, totalCR, monsterFeats);
		var offensiveCR = offensiveCRStats.offensiveCR;
		AB = offensiveCRStats.attackBonus;
		DPR = offensiveCRStats.damagePerRound;
		
	//Display Defensive CR
		display = document.getElementById("defensiveCRDisplay");
		display.innerHTML = CRtoFraction(defensiveCR);
		
	//Display Offensive CR
		display = document.getElementById("offensiveCRDisplay");
		display.innerHTML = CRtoFraction(offensiveCR);
	
	//Display Offensive Stats (Attack Bonus and Damage Per Round)
		document.getElementById("attackBonus").value = AB;
		document.getElementById("damagePerRound").value = DPR;		
	
	//Display Total CR	
		display = document.getElementById("totalCRDisplay");
		display.innerHTML = CRtoFraction(totalCR);
	}
	
	function CRtoFraction(CR) {
		if		(CR == 0.125) return "1/8";
		else if	(CR == 0.25)  return "1/4";
		else if	(CR == 0.5)   return "1/2";
		else 				  return CR;
	}

	function recalcDefensiveCR(ACin, HPin, FEATSin) {		
	//Get raw ARMOR CLASS and HIT POINTS
		var effectiveAC = ACin;
		var effectiveHP = HPin;
	
	//Add MONSTER FEAT bonuses
		if(FEATSin["Avoidance"])			effectiveAC += 1;
		if(FEATSin["NimbleEscape"])			effectiveAC += 4;
		
	//Get a defensive CR baseline based on HP
		var HPCR = getHPCR(effectiveHP);

	//Adjust defensive CR based on Armor Class
		var expectedAC = ACLevels[HPCR];
		var defensiveCR = nextCR(HPCR, ((effectiveAC - expectedAC)/2 | 0));
	
	//Return result
		return defensiveCR;
	}
	
	function recalcOffensiveCR(ABin, DPRin, HPin, FEATSin) {		
	//Get raw ATTACK BONUS and DAMAGE PER ROUND
		var effectiveAB = ABin;
		var effectiveDPR = DPRin;
	
	//Add MONSTER FEAT bonuses
		if(FEATSin["Aggressive"])			effectiveDPR += 2;
		if(FEATSin["Ambusher"])				effectiveAB += 1;
		if(FEATSin["BloodFrenzy"])			effectiveAB += 4;
		if(FEATSin["Charge"])				effectiveDPR /= 3/4;
		if(FEATSin["DamageTransfer"])		effectiveDPR += HPin/3;
		if(FEATSin["Dive"])					effectiveDPR /= 3/4;
		if(FEATSin["ElementalBody"])		effectiveDPR += 5;
		if(FEATSin["Enlarge"])				effectiveDPR /= 1/2;
		if(FEATSin["MartialAdvantage"])		effectiveDPR /= 2/3;
		if(FEATSin["NimbleEscape"])			effectiveAB += 4;
		if(FEATSin["PackTactics"])			effectiveAB += 1;
		if(FEATSin["Pounce"])				effectiveDPR /= 3/4;
		if(FEATSin["Rampage"])				effectiveDPR += 2;
		if(FEATSin["SurpriseAttack"])		effectiveDPR /= 3/4;
		if(FEATSin["Swallow"])				effectiveDPR /= 2/3;
		if(FEATSin["WoundedFury"])			effectiveDPR /= 3/4;	
				
	//Get a offensive CR baseline based on DPR
		var DPRCR = getDPRCR(effectiveDPR);

	//Adjust offensive CR based on Attack Bonus
		var expectedAB = ABLevels[DPRCR];
		var offensiveCR = nextCR(DPRCR, ((effectiveAB - expectedAB)/2 | 0));
	
	//Return result
		return offensiveCR;
	}	
	
	function estimateOffensiveCR(defensiveCRin, totalCRin, FEATSin)
	{
		var offensiveCR = totalCRin * 2 - defensiveCRin;
	
	//Handle cases when offensiveCR is a weird fraction
		if	   (					   offensiveCR < 1/16)	offensiveCR = 0;
		else if(1/16 <= offensiveCR && offensiveCR < 3/16)	offensiveCR = 1/8;
		else if(3/16 <= offensiveCR && offensiveCR < 6/16)	offensiveCR = 1/4;
		else if(6/16 <= offensiveCR && offensiveCR < 12/16)	offensiveCR = 1/2;
		else offensiveCR = Math.round(offensiveCR);
				
	//Estimate ATTACK BONUS given the calculated offensive CR		
		var AB = ABLevels[offensiveCR];
	
	//Estimate DAMAGE PER ROUND given the calculated offensive CR
		var rangeLower = DPRLevels[nextLowerCR(offensiveCR)] + 1;
		var rangeUpper = DPRLevels[offensiveCR];		
		var DPR = Math.ceil((rangeLower + rangeUpper) / 2);				//Put DPR at the middle value for this CR
							
	//Add MONSTER FEAT bonuses
		if(FEATSin["Aggressive"])			DPR -= 2;
		if(FEATSin["Ambusher"])				AB -= 1;
		if(FEATSin["BloodFrenzy"])			AB -= 4;
		if(FEATSin["Charge"])				DPR *= 3/4;	//Increases DPR of one attack (to about double).  Not included in Monster DPR	
		if(FEATSin["DamageTransfer"])		DPR -= HP/3;
		if(FEATSin["Dive"])					DPR *= 3/4;	//Increases DPR of one round (to about double).  Not included in Monster DPR.
		if(FEATSin["ElementalBody"])		DPR -= 5;	//Increases total DPR (usually by about 5).
		if(FEATSin["Enlarge"])				DPR *= 1/2;	//Increases total DPR by about 100%.
		if(FEATSin["MartialAdvantage"])		DPR *= 2/3;	//Increases total DPR by about 50%.		
		if(FEATSin["NimbleEscape"])			AB -= 4;		
		if(FEATSin["PackTactics"])			AB -= 1;		
		if(FEATSin["Pounce"])				DPR *= 3/4;	//Increases DPR of one attack (essentially double)		
		if(FEATSin["Rampage"])				DPR -= 2;		
		if(FEATSin["SurpriseAttack"])		DPR *= 3/4;	//Increases DPR of one attack (essentially double)		
		if(FEATSin["Swallow"])				DPR *= 2/3;	//Increases DPR by about 50%, but varies greatly	
		if(FEATSin["WoundedFury"])			DPR *= 3/4;	//Increases DPR of one round (to about double).  Not included in Monster DPR.
	
	//Return results	
		return {offensiveCR: offensiveCR, attackBonus: AB, damagePerRound: DPR};
	}
	
	function nextLowerCR(current) {
		if	   (current == 1)	return 1/2;
		else if(current == 1/2)	return 1/4;
		else if(current == 1/4) return 1/8;
		else if(current == 1/8) return 0;
		else if(current == 0)	return 0;
		else					return (current - 1);
	}
	
	function nextHigherCR(current) {
		if	   (current == 0)	return 1/8;
		else if(current == 1/8) return 1/4;
		else if(current == 1/4) return 1/2;
		else if(current == 1/2)	return 1;
		else if(current == 30)	return 30;
		else					return (current + 1);
	}
	
	function nextCR(current, diff) {
		var result = current;
		if(diff > 0)
		{
			for(var i = 0; i < diff; i++)
			{
				result = nextHigherCR(result);
			}
		}
		else
		{
			for(var i = diff; i < 0; i++)
			{
				result = nextLowerCR(result);
			}
		}
		return result;
	}
	
	function getHPCR(HP) {
		var HPCR = 0;
		
		if	   (1   <= HP && HP <= 6)   HPCR = 0;
		else if(7   <= HP && HP <= 35)  HPCR = 1/8;
		else if(36  <= HP && HP <= 49)  HPCR = 1/4;
		else if(50  <= HP && HP <= 70)  HPCR = 1/2;
		else if(71  <= HP && HP <= 85)  HPCR = 1;
		else if(86  <= HP && HP <= 100) HPCR = 2;
		else if(101 <= HP && HP <= 115) HPCR = 3;
		else if(116 <= HP && HP <= 130) HPCR = 4;
		else if(131 <= HP && HP <= 145) HPCR = 5;
		else if(146 <= HP && HP <= 160) HPCR = 6;
		else if(161 <= HP && HP <= 175) HPCR = 7;
		else if(176 <= HP && HP <= 190) HPCR = 8;
		else if(191 <= HP && HP <= 205) HPCR = 9;
		else if(206 <= HP && HP <= 220) HPCR = 10;
		else if(221 <= HP && HP <= 235) HPCR = 11;
		else if(236 <= HP && HP <= 250) HPCR = 12;
		else if(251 <= HP && HP <= 265) HPCR = 13;
		else if(266 <= HP && HP <= 280) HPCR = 14;
		else if(281 <= HP && HP <= 295) HPCR = 15;
		else if(296 <= HP && HP <= 310) HPCR = 16;
		else if(311 <= HP && HP <= 325) HPCR = 17;
		else if(326 <= HP && HP <= 340) HPCR = 18;
		else if(341 <= HP && HP <= 355) HPCR = 19;
		else if(356 <= HP && HP <= 400) HPCR = 20;
		else if(401 <= HP && HP <= 445) HPCR = 21;
		else if(446 <= HP && HP <= 490) HPCR = 22;
		else if(491 <= HP && HP <= 535) HPCR = 23;
		else if(536 <= HP && HP <= 580) HPCR = 24;
		else if(581 <= HP && HP <= 625) HPCR = 25;
		else if(626 <= HP && HP <= 670) HPCR = 26;
		else if(671 <= HP && HP <= 715) HPCR = 27;
		else if(716 <= HP && HP <= 760) HPCR = 28;
		else if(761 <= HP && HP <= 805) HPCR = 29;
		else if(806 <= HP && HP <= 850) HPCR = 30;
		
		return HPCR;
	}
	
	function getDPRCR(DPR) {
		var DPRCR = 0;
		
		if	   (0  <= DPR && DPR <= 1)  DPRCR = 0;
		else if(2  <= DPR && DPR <= 3)  DPRCR = 1/8;
		else if(4  <= DPR && DPR <= 5)  DPRCR = 1/4;
		else if(6  <= DPR && DPR <= 8)  DPRCR = 1/2;
		else if(9  <= DPR && DPR <= 14) DPRCR = 1;
		else if(15 <= DPR && DPR <= 20) DPRCR = 2;
		else if(21 <= DPR && DPR <= 26) DPRCR = 3;
		else if(27 <= DPR && DPR <= 32) DPRCR = 4;
		else if(33 <= DPR && DPR <= 38) DPRCR = 5;
		else if(39 <= DPR && DPR <= 44) DPRCR = 6;
		else if(45 <= DPR && DPR <= 50) DPRCR = 7;
		else if(51 <= DPR && DPR <= 56) DPRCR = 8;
		else if(57 <= DPR && DPR <= 62) DPRCR = 9;
		else if(63 <= DPR && DPR <= 68) DPRCR = 10;
		else if(69 <= DPR && DPR <= 74) DPRCR = 11;
		else if(75 <= DPR && DPR <= 80) DPRCR = 12;
		else if(81 <= DPR && DPR <= 86) DPRCR = 13;
		else if(87 <= DPR && DPR <= 92) DPRCR = 14;
		else if(93 <= DPR && DPR <= 98) DPRCR = 15;
		else if(99 <= DPR && DPR <= 104) DPRCR = 16;
		else if(105 <= DPR && DPR <= 110) DPRCR = 17;
		else if(111 <= DPR && DPR <= 116) DPRCR = 18;
		else if(117 <= DPR && DPR <= 122) DPRCR = 19;
		else if(123 <= DPR && DPR <= 140) DPRCR = 20;
		else if(141 <= DPR && DPR <= 158) DPRCR = 21;
		else if(159 <= DPR && DPR <= 176) DPRCR = 22;
		else if(177 <= DPR && DPR <= 194) DPRCR = 23;
		else if(195 <= DPR && DPR <= 212) DPRCR = 24;
		else if(213 <= DPR && DPR <= 230) DPRCR = 25;
		else if(231 <= DPR && DPR <= 248) DPRCR = 26;
		else if(249 <= DPR && DPR <= 266) DPRCR = 27;
		else if(267 <= DPR && DPR <= 284) DPRCR = 28;
		else if(285 <= DPR && DPR <= 302) DPRCR = 29;
		else if(303 <= DPR && DPR <= 320) DPRCR = 30;
		
		return DPRCR;
	}
	
	function saveMonster() {
	//Collect monster data into an object to save
		monsterData = {};
		monsterData["monsterName"] = document.getElementById("monsterName").value;
		monsterData["armorClass"] = AC;
		monsterData["hitPoints"] = HP;
		monsterData["attackBonus"] = AB;
		monsterData["damagePerRound"] = DPR;
		monsterData["monsterFeats"] = monsterFeats;
		monsterData["totalCR"] = totalCR;
		monsterData["totalXP"] = XPLevels[totalCR];
		
		var monsterArray = JSON.parse(localStorage.getItem('monsterArray'));
	
	//Edit monster table
		if(editing == true)		//If we are editing an existing monster, just overwrite the old table data
		{
			var table = document.getElementById("monsterList");
			var row = table.rows[editingMonster];
			var nameCell = row.cells[0];
			var CRCell = row.cells[1];
			var countCell = row.cells[2];
			
			nameCell.innerHTML = document.getElementById("monsterName").value;
			CRCell.innerHTML = totalCR;
			
			monsterData["count"] = monsterArray[editingMonster - 1]["count"];
			
			monsterArray.splice(editingMonster - 1, 1, monsterData);		//Replace edited monster in list
			editing = false;
		}
		else					//Otherwise create a new row in the table
		{
			var table = document.getElementById("monsterList");
			editingMonster = table.rows.length;
			console.log("editingMonster " + editingMonster);
			var row = table.insertRow(-1);
			var nameCell = row.insertCell(-1);
			nameCell.innerHTML = document.getElementById("monsterName").value;
			var CRCell = row.insertCell(-1);
			CRCell.innerHTML = totalCR;
			var countCell = row.insertCell(-1);
			countCell.innerHTML = 1;
			console.log(countCell.parentNode);
			var plusButtonCell = row.insertCell(-1);
			plusButtonCell.innerHTML = "<button onclick='changeMonsterCount(this.parentNode.parentNode.rowIndex, 1);'>+</button>";
			var minusButtonCell = row.insertCell(-1);
			minusButtonCell.innerHTML = "<button onclick='changeMonsterCount(this.parentNode.parentNode.rowIndex, -1);'>-</button>";
			var editButtonCell = row.insertCell(-1);
			editButtonCell.innerHTML = "<button onclick='editMonster(this.parentNode.parentNode.rowIndex)'>Edit</button>";
			var deleteButtonCell = row.insertCell(-1);
			deleteButtonCell.innerHTML = "<button onclick='deleteMonster(this.parentNode.parentNode.rowIndex)'>Delete</button>";
			var commentsButtonCell = row.insertCell(-1);
			commentsButtonCell.innerHTML = "COMMENTS";
			
			monsterData["count"] = 1;
			
			monsterArray.splice(monsterArray.length, 0, monsterData);		//Append new monster to end of list
		}

	//Save changes to local storage	
		localStorage.setItem("monsterArray", JSON.stringify(monsterArray));

		calculateEncounterDifficulty(monsterArray);
	}
	
	function changeMonsterCount(index, diff) {
		var table = document.getElementById("monsterList");
		var countCell = table.rows[index].cells[2];
		countCell.innerHTML = parseInt(countCell.innerHTML) + diff;
		
		var monsterArray = JSON.parse(localStorage.getItem('monsterArray'));
		monsterArray[index - 1]["count"] = parseInt(countCell.innerHTML);
		
		localStorage.setItem("monsterArray", JSON.stringify(monsterArray));
		
		calculateEncounterDifficulty(monsterArray);
	}
	
	function editMonster(monsterIndex) {		
	//Read stored list
		var monsterArray = JSON.parse(localStorage.getItem('monsterArray'));
		var monsterData = monsterArray[monsterIndex - 1];
		console.log(monsterIndex);
		console.log(monsterData);
		console.log(monsterArray);
		document.getElementById("monsterName").value = monsterData["monsterName"];
		
		document.getElementById("challengeRating").value = monsterData["totalCR"];
		document.getElementById("challengeRating").onchange();		
		document.getElementById("armorClass").value = monsterData["armorClass"];
		document.getElementById("armorClass").onchange();
		document.getElementById("hitPoints").value = monsterData["hitPoints"];
		document.getElementById("hitPoints").onchange();
		
		
		editing = true;
		editingMonster = monsterIndex;

		for(var i = 0; i < Object.keys(monsterData["monsterFeats"]).length; i++)
		{
			var checkbox = document.querySelector('input[value="' + Object.keys(monsterData["monsterFeats"])[i] +'"]');
			console.log(checkbox);
			checkbox.checked = true;
		}
	
	//Save changes to local storage
		localStorage.setItem("monsterArray", JSON.stringify(monsterArray));
	}
	
	function deleteMonster(monsterIndex) {
		
		var table = document.getElementById("monsterList");
		table.deleteRow(monsterIndex);
		
	//Edit stored list
		var monsterArray = JSON.parse(localStorage.getItem('monsterArray'));
		monsterArray.splice(monsterIndex - 1, 1);
		
		console.log(monsterArray);
	
	//Save changes to local storage
		localStorage.setItem("monsterArray", JSON.stringify(monsterArray));
		
		calculateEncounterDifficulty(monsterArray);
	}
	
	function setupPage() {
		AC = ACLevels[1];
		HP = HPLevels[1];
		totalCR = 1;
	
		document.getElementById("armorClass").value = AC;
		document.getElementById("hitPoints").value = HP;
		document.getElementById("challengeRating").value = totalCR;
		
		recalcTotalCR();

		var monsterArray = [];
		localStorage.setItem('monsterArray', JSON.stringify(monsterArray));
		
		var encounterArray = [];
		localStorage.setItem('encounterArray', JSON.stringify(encounterArray));
	}
	
//====-- XP THRESHOLDS --====//	
	//XP Thresholds (EASY)
	var XPThresholdEasy = {};
	XPThresholdEasy[1] = 25;	  XPThresholdEasy[2] = 50;	     XPThresholdEasy[3] = 75;	    XPThresholdEasy[4] = 125;
	XPThresholdEasy[5] = 250;	  XPThresholdEasy[6] = 300;	     XPThresholdEasy[7] = 350;	    XPThresholdEasy[8] = 450;
	XPThresholdEasy[9] = 550;	  XPThresholdEasy[10] = 600;	 XPThresholdEasy[11] = 800;	    XPThresholdEasy[12] = 1000;
	XPThresholdEasy[13] = 1100;	  XPThresholdEasy[14] = 1250;	 XPThresholdEasy[15] = 1400;	XPThresholdEasy[16] = 1600;
	XPThresholdEasy[17] = 2000;	  XPThresholdEasy[18] = 2100;	 XPThresholdEasy[19] = 2400;	XPThresholdEasy[20] = 2800;
	
	//XP Thresholds (MEDIUM)
	var XPThresholdMedium = {};
	XPThresholdMedium[1] = 50;	  XPThresholdMedium[6] = 600;	 XPThresholdMedium[11] = 1600;	XPThresholdMedium[16] = 3200;
	XPThresholdMedium[2] = 100;	  XPThresholdMedium[7] = 750;	 XPThresholdMedium[12] = 2000;	XPThresholdMedium[17] = 3900;
	XPThresholdMedium[3] = 150;	  XPThresholdMedium[8] = 900;	 XPThresholdMedium[13] = 2200;	XPThresholdMedium[18] = 4200;
	XPThresholdMedium[4] = 250;	  XPThresholdMedium[9] = 1100;	 XPThresholdMedium[14] = 2500;	XPThresholdMedium[19] = 4900;
	XPThresholdMedium[5] = 500;	  XPThresholdMedium[10] = 1200;	 XPThresholdMedium[15] = 2800;	XPThresholdMedium[20] = 5700;
	                                                       
	//XP Thresholds (HARD)
	var XPThresholdHard = {};
	XPThresholdHard[1] = 75;	  XPThresholdHard[6] = 900;	     XPThresholdHard[11] = 2400;	XPThresholdHard[16] = 4800;
	XPThresholdHard[2] = 150;     XPThresholdHard[7] = 1100;     XPThresholdHard[12] = 3000;    XPThresholdHard[17] = 5900;
	XPThresholdHard[3] = 225;     XPThresholdHard[8] = 1400;     XPThresholdHard[13] = 3400;    XPThresholdHard[18] = 6300;
	XPThresholdHard[4] = 375;     XPThresholdHard[9] = 1600;     XPThresholdHard[14] = 3800;    XPThresholdHard[19] = 7300;
	XPThresholdHard[5] = 750;     XPThresholdHard[10] = 1900;    XPThresholdHard[15] = 4300;    XPThresholdHard[20] = 8500;
	
	//XP Thresholds (DEADLY)
	var XPThresholdDeadly = {};
	XPThresholdDeadly[1] = 100;	  XPThresholdDeadly[6] = 1400;   XPThresholdDeadly[11] = 3600;  XPThresholdDeadly[16] = 7200;
	XPThresholdDeadly[2] = 200;   XPThresholdDeadly[7] = 1700;   XPThresholdDeadly[12] = 4500;  XPThresholdDeadly[17] = 8800;
	XPThresholdDeadly[3] = 400;   XPThresholdDeadly[8] = 2100;   XPThresholdDeadly[13] = 5100;  XPThresholdDeadly[18] = 9500;
	XPThresholdDeadly[4] = 500;   XPThresholdDeadly[9] = 2400;   XPThresholdDeadly[14] = 5700;  XPThresholdDeadly[19] = 10900;
	XPThresholdDeadly[5] = 1100;  XPThresholdDeadly[10] = 2800;  XPThresholdDeadly[15] = 6400;  XPThresholdDeadly[20] = 12700;	
//====-----------------------====//

	//Estimated Armor Class at each level
	var ACLevels = {};
	ACLevels[0] = 13;    ACLevels[1] = 13;   ACLevels[11] = 17;  ACLevels[21] = 19;
	ACLevels[1/8] = 13;  ACLevels[2] = 13;   ACLevels[12] = 17;  ACLevels[22] = 19;
	ACLevels[1/4] = 13;  ACLevels[3] = 13;   ACLevels[13] = 18;  ACLevels[23] = 19;
	ACLevels[1/2] = 13;  ACLevels[4] = 14;   ACLevels[14] = 18;  ACLevels[24] = 19;
	                     ACLevels[5] = 15;   ACLevels[15] = 18;  ACLevels[25] = 19;
	                     ACLevels[6] = 15;   ACLevels[16] = 18;  ACLevels[26] = 19;
	                     ACLevels[7] = 15;   ACLevels[17] = 19;  ACLevels[27] = 19;
	                     ACLevels[8] = 16;   ACLevels[18] = 19;  ACLevels[28] = 19;
	                     ACLevels[9] = 16;   ACLevels[19] = 19;  ACLevels[29] = 19;
	                     ACLevels[10] = 17;  ACLevels[20] = 19;  ACLevels[30] = 19;
		                                                                        
	//Estimated Hit Points at each level                                        
	var HPLevels = {};
	HPLevels[0] = 6;     HPLevels[1] = 85;   HPLevels[11] = 235; HPLevels[21] = 445;
	HPLevels[1/8] = 35;  HPLevels[2] = 100;  HPLevels[12] = 250; HPLevels[22] = 490;
	HPLevels[1/4] = 49;  HPLevels[3] = 115;  HPLevels[13] = 265; HPLevels[23] = 535;
	HPLevels[1/2] = 70;  HPLevels[4] = 130;  HPLevels[14] = 280; HPLevels[24] = 580;
	                     HPLevels[5] = 145;  HPLevels[15] = 295; HPLevels[25] = 625;
	                     HPLevels[6] = 160;  HPLevels[16] = 310; HPLevels[26] = 670;
	                     HPLevels[7] = 175;  HPLevels[17] = 325; HPLevels[27] = 715;
	                     HPLevels[8] = 190;  HPLevels[18] = 340; HPLevels[28] = 760;
	                     HPLevels[9] = 205;  HPLevels[19] = 355; HPLevels[29] = 805;
	                     HPLevels[10] = 220; HPLevels[20] = 400; HPLevels[30] = 850;
	
	//Estimated Attack Bonus at each level
	var ABLevels = {};
	ABLevels[0] = 3;     ABLevels[1] = 3;    ABLevels[11] = 8;   ABLevels[21] = 11;
	ABLevels[1/8] = 3;   ABLevels[2] = 3;    ABLevels[12] = 8;   ABLevels[22] = 11;
	ABLevels[1/4] = 3;   ABLevels[3] = 4;    ABLevels[13] = 8;   ABLevels[23] = 11;
	ABLevels[1/2] = 3;   ABLevels[4] = 5;    ABLevels[14] = 8;   ABLevels[24] = 12;
	                     ABLevels[5] = 6;    ABLevels[15] = 8;   ABLevels[25] = 12;
	                     ABLevels[6] = 6;    ABLevels[16] = 9;   ABLevels[26] = 12;
	                     ABLevels[7] = 6;    ABLevels[17] = 10;  ABLevels[27] = 13;
	                     ABLevels[8] = 7;    ABLevels[18] = 10;  ABLevels[28] = 13;
	                     ABLevels[9] = 7;    ABLevels[19] = 10;  ABLevels[29] = 13;
	                     ABLevels[10] = 7;   ABLevels[20] = 10;  ABLevels[30] = 14;
	
	//Estimated Damage per Round at each level
	var DPRLevels = {};  DPRLevels[1] = 14;  DPRLevels[11] = 74;  DPRLevels[21] = 158;
	DPRLevels[0] = 1;    DPRLevels[2] = 20;  DPRLevels[12] = 80;  DPRLevels[22] = 176;
	DPRLevels[1/8] = 3;  DPRLevels[3] = 26;  DPRLevels[13] = 86;  DPRLevels[23] = 194;
	DPRLevels[1/4] = 5;  DPRLevels[4] = 32;  DPRLevels[14] = 92;  DPRLevels[24] = 212;
	DPRLevels[1/2] = 8;  DPRLevels[5] = 38;  DPRLevels[15] = 98;  DPRLevels[25] = 230;
	                     DPRLevels[6] = 44;  DPRLevels[16] = 104; DPRLevels[26] = 248;
	                     DPRLevels[7] = 50;  DPRLevels[17] = 110; DPRLevels[27] = 266;
	                     DPRLevels[8] = 56;  DPRLevels[18] = 116; DPRLevels[28] = 284;
	                     DPRLevels[9] = 62;  DPRLevels[19] = 122; DPRLevels[29] = 302;
	                     DPRLevels[10] = 68; DPRLevels[20] = 140; DPRLevels[30] = 320;	
	
	//XP at each level
	var XPLevels = {};
	XPLevels[0] = 0;
	XPLevels[1/8] = 25;
	XPLevels[1/4] = 50;
	XPLevels[1/2] = 100;
	XPLevels[1] = 200;
	XPLevels[2] = 450;
	XPLevels[3] = 700;
	XPLevels[4] = 1100;
	XPLevels[5] = 1800;
	XPLevels[6] = 2300;
	XPLevels[7] = 2900;
	XPLevels[8] = 3900;
	XPLevels[9] = 5000;
	XPLevels[10] = 5900;
	XPLevels[11] = 7200;
	XPLevels[12] = 8400;
	XPLevels[13] = 10000;
	XPLevels[14] = 11500;
	XPLevels[15] = 13000;
	XPLevels[16] = 15000;
	XPLevels[17] = 18000;
	XPLevels[18] = 20000;
	XPLevels[19] = 22000;
	XPLevels[20] = 25000;
	XPLevels[21] = 33000;
	XPLevels[22] = 41000;
	XPLevels[23] = 50000;
	XPLevels[24] = 62000;
	XPLevels[25] = 75000;
	XPLevels[26] = 90000;
	XPLevels[27] = 105000;
	XPLevels[28] = 120000;
	XPLevels[29] = 135000;
	XPLevels[30] = 155000;
</script>

</body>
</html>